Run Get-ChildItem C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\*.nupkg -Recurse | Foreach-Object {
file: C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.2024.2.1.66.nupkg
Pushing Cigna.Email.Smtp.2024.2.1.66.nupkg to 'https://nuget.pkg.github.com/zilvertonz'...
  PUT https://nuget.pkg.github.com/zilvertonz/
warn : Your request could not be authenticated by the GitHub Packages service. Please ensure your access token is valid and has the appropriate scopes configured.
  Forbidden https://nuget.pkg.github.com/zilvertonz/ 103ms
error: Response status code does not indicate success: 403 (Forbidden).
file: C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.Domain.2024.2.1.66.nupkg
Pushing Cigna.Email.Smtp.Domain.2024.2.1.66.nupkg to 'https://nuget.pkg.github.com/zilvertonz'...
  PUT https://nuget.pkg.github.com/zilvertonz/
warn : Your request could not be authenticated by the GitHub Packages service. Please ensure your access token is valid and has the appropriate scopes configured.
  Forbidden https://nuget.pkg.github.com/zilvertonz/ 172ms
error: Response status code does not indicate success: 403 (Forbidden).
file: C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HSLogger.2024.2.1.66.nupkg
Pushing Cigna.Email.Smtp.HSLogger.2024.2.1.66.nupkg to 'https://nuget.pkg.github.com/zilvertonz'...
  PUT https://nuget.pkg.github.com/zilvertonz/
  OK https://nuget.pkg.github.com/zilvertonz/ 314ms
Your package was pushed.

==========================================================================
Run dotnet nuget list source
Registered Sources:
  1.  github [Enabled]
      https://nuget.pkg.github.com/zilvertonz/index.json
  2.  nuget.org [Enabled]
      https://api.nuget.org/v3/index.json
  3.  Microsoft Visual Studio Offline Packages [Enabled]
      C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\
  Determining projects to restore...
  All projects are up-to-date for restore.
C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.Tests\Cigna.Email.Smtp.Tests.csproj(84,5): error : This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is ..\packages\MSTest.TestAdapter.2.2.10\build\net46\MSTest.TestAdapter.props.
  Cigna.Email.Smtp -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp\bin\Release\netstandard2.0\Cigna.Email.Smtp.dll
  Cigna.Email.Smtp.HsLogger -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\net472\Cigna.Email.Smtp.HsLogger.dll
  Cigna.Email.Smtp.HsLogger -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\net48\Cigna.Email.Smtp.HsLogger.dll
  Successfully created package 'C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp\bin\Release\Cigna.Email.Smtp.2024.2.0.60.nupkg'.
  Cigna.Email.Smtp.HsLogger -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\net462\Cigna.Email.Smtp.HsLogger.dll
  Successfully created package 'C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\Cigna.Email.Smtp.HSLogger.2024.2.0.60.nupkg'.

Build FAILED.

C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.Tests\Cigna.Email.Smtp.Tests.csproj(84,5): error : This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is ..\packages\MSTest.TestAdapter.2.2.10\build\net46\MSTest.TestAdapter.props.
    0 Warning(s)
    1 Error(s)

Time Elapsed 00:00:17.23

Workload updates are available. Run `dotnet workload list` for more information.
Error: Process completed with exit code 1.
0s



----------------=
Run dotnet build C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\ --configuration Release
  dotnet build C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\ --configuration Release
  shell: C:\Program Files\PowerShell\7\pwsh.EXE -command ". '{0}'"
  env:
    NUGET_DIR: C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\publish
    PACKAGE_TOKEN: ***
    PACKAGE_USER: GTHBAUTO_Zilver
  Determining projects to restore...
  Restored C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp\Cigna.Email.Smtp.csproj (in 5.71 sec).
  Restored C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\Cigna.Email.Smtp.HsLogger.csproj (in 5.81 sec).
C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.Tests\Cigna.Email.Smtp.Tests.csproj(84,5): error : This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is ..\packages\MSTest.TestAdapter.2.2.10\build\net46\MSTest.TestAdapter.props.
  Cigna.Email.Smtp -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp\bin\Release\netstandard2.0\Cigna.Email.Smtp.dll
  Cigna.Email.Smtp.HsLogger -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\net48\Cigna.Email.Smtp.HsLogger.dll
  Cigna.Email.Smtp.HsLogger -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\net472\Cigna.Email.Smtp.HsLogger.dll
  Successfully created package 'C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp\bin\Release\Cigna.Email.Smtp.2024.2.0.32.nupkg'.
  Cigna.Email.Smtp.HsLogger -> C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\net462\Cigna.Email.Smtp.HsLogger.dll
  Successfully created package 'C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.HsLogger\bin\Release\Cigna.Email.Smtp.HSLogger.2024.2.0.32.nupkg'.

Build FAILED.

C:\a\usmg-daga-smtp-dot-net\usmg-daga-smtp-dot-net\Cigna.Email.Smtp.Tests\Cigna.Email.Smtp.Tests.csproj(84,5): error : This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is ..\packages\MSTest.TestAdapter.2.2.10\build\net46\MSTest.TestAdapter.props.
    0 Warning(s)
    1 Error(s)

Time Elapsed 00:00:35.89

Workload updates are available. Run `dotnet workload list` for more information.
Error: Process completed with exit code 1.

==========================================
PUBLISH SQL TO: C:\a\usmg-RAES-RiskAdjustmentAudit\usmg-RAES-RiskAdjustmentAudit\build\sql     13386372807327
Inorder to run this script be sure to:  
     #1 install SqlPackage.  You can use the powershell command:  choco install sqlpackage
     #2 add msbuild to your path environment
--------------------------------------------
MSBuild version 17.13.15+18b3035f6 for .NET Framework
Build started 3/13/2025 8:53:27 PM.

Project "C:\a\usmg-RAES-RiskAdjustmentAudit\usmg-RAES-RiskAdjustmentAudit\RiskAdjustmentAudit\RiskAdjustmentAudit.Sql\RiskAdjustmentAudit.Sql.sqlproj" on node 1 (default targets).
C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\Microsoft.Common.CurrentVersion.targets(1259,5): error MSB3644: The reference assemblies for .NETFramework,Version=v4.5 were not found. To resolve this, install the Developer Pack (SDK/Targeting Pack) for this framework version or retarget your application. You can download .NET Framework Developer Packs at https://aka.ms/msbuild/developerpacks [C:\a\usmg-RAES-RiskAdjustmentAudit\usmg-RAES-RiskAdjustmentAudit\RiskAdjustmentAudit\RiskAdjustmentAudit.Sql\RiskAdjustmentAudit.Sql.sqlproj]
_CleanRecordFileWrites:
  Creating directory "obj\\".
Done Building Project "C:\a\usmg-RAES-RiskAdjustmentAudit\usmg-RAES-RiskAdjustmentAudit\RiskAdjustmentAudit\RiskAdjustmentAudit.Sql\RiskAdjustmentAudit.Sql.sqlproj" (default targets) -- FAILED.

Build FAILED.

"C:\a\usmg-RAES-RiskAdjustmentAudit\usmg-RAES-RiskAdjustmentAudit\RiskAdjustmentAudit\RiskAdjustmentAudit.Sql\RiskAdjustmentAudit.Sql.sqlproj" (default target) (1) ->
(GetReferenceAssemblyPaths target) -> 
  C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\Microsoft.Common.CurrentVersion.targets(1259,5): error MSB3644: The reference assemblies for .NETFramework,Version=v4.5 were not found. To resolve this, install the Developer Pack (SDK/Targeting Pack) for this framework version or retarget your application. You can download .NET Framework Developer Packs at https://aka.ms/msbuild/developerpacks [C:\a\usmg-RAES-RiskAdjustmentAudit\usmg-RAES-RiskAdjustmentAudit\RiskAdjustmentAudit\RiskAdjustmentAudit.Sql\RiskAdjustmentAudit.Sql.sqlproj]



==================
Creating sample dll for testing 
Add-Type -TypeDefinition 'namespace SampleLibrary { public class TestClass { public string GetMessage() { return "Hello from Sample DLL!"; } } }' -Language CSharp -OutputAssembly SampleLibrary.dll

====================

Processing manifest.json...
Found 1 1 packages to process
Processing package: package-version
  Name: PACKAGE
  Version: 1.12
  Build: 1
  Found package version: 1.12 (build: 1)
Processing package: gbs-fcts-lpi-calc
  Name: LatePaymentInterest_SC
  Version: 5.0.3
  Build: 1
  Downloading: LatePaymentInterest_SC.5.0.3.1-gbs-fcts-lpi-calc.nupkg
  URL: https://cigna.jfrog.io/artifactory/cigna-nuget-lower/Cigna/GBS/Cornerstone/Facets/gbs-fcts-lpi-calc/LatePaymentInterest_SC.5.0.3.1-gbs-fcts-lpi-calc.nupkg
WARNING:   Failed to download package from https://cigna.jfrog.io/artifactory/cigna-nuget-lower/Cigna/GBS/Cornerstone/Facets/gbs-fcts-lpi-calc/LatePaymentInterest_SC.5.0.3.1-gbs-fcts-lpi-calc.nupkg : 
403 Forbidden

403 Forbidden
nginx



Package processing completed. Summary:
----------------------------------------
Total packages processed: 0
Using package version: 1.12 (build: 1)
----------------------------------------

================================================================
Run Write-Output "[INFO] Fetching NuGet Packages..."
  Write-Output "[INFO] Fetching NuGet Packages..."
  
  # Create error log directory
  New-Item -ItemType Directory -Path ".\logs" -Force | Out-Null
  
  $packages = Get-Content './manifest.json' -Raw | ConvertFrom-Json
  $keys = $packages.PSObject.Properties.Name
  $hasErrors = $false
  $package_version = ""
  $package_build = ""
  
  foreach ($key in $keys) {
      $name = $packages.$key.name
      if($name -eq "PACKAGE") { 
          $package_version = $packages.$key.version
          $package_build = $packages.$key.build
          Write-Output "package version $package_version"
          continue
      }
      
      $version = $packages.$key.version
      $build = $packages.$key.build
      
      Write-Output "[INFO] Processing $key (version: $version, build: $build)"
      
      try {
          # Construct the URL to the directory containing the packages
          $myUri = "https://cigna.jfrog.io/artifactory/cigna-nuget-lower/Cigna/GBS/Cornerstone/Facets/$key/"
          Write-Output "[INFO] Checking: $myUri"
          
          try {
              # Get the directory listing
              $response = Invoke-WebRequest -Uri $myUri -UseBasicParsing
              
              # Print version for debugging
              Write-Output "$version"
              
              # Parse the links from the response
              $links = $response.Links | Where-Object { $_.href -ne '../' }
              
              # Find the specific package based on version and build
              $targetVersion = "$version.$build"
              $latestPackage = $null
              
              # Look for packages matching our target version
              foreach ($link in $links) {
                  # Extract version from link
                  $linkVersion = [regex]::Match($link.href, "\d+\.\d+\.\d+\.\d+").Value
                  
                  
                  # Extract the nupkg (which is a zip file)
                  Add-Type -AssemblyName System.IO.Compression.FileSystem
                  [System.IO.Compression.ZipFile]::ExtractToDirectory($outputPath, ".\build\nupkg\$name")
                  
                  Write-Output "Directory: $(Get-Location)\build\bin"
                  Get-ChildItem -Path ".\build\bin" -Directory | Format-Table
                  
                  # Move DLL files to bin directory
                  Write-Output "Directory: `n$(Get-Location)\build\bin\$name"
                  Get-ChildItem -Path ".\build\nupkg\$name" -Filter "*.dll" -Recurse | 
                      Move-Item -Destination ".\build\bin\$name" -Force
                      
                  # List the files in the bin directory
                  Get-ChildItem -Path ".\build\bin\$name" | Format-Table Mode, LastWriteTime, Length, Name
                  
                  # Cleanup
                  Remove-Item -Path $outputPath -Force
              } else {
                  throw "Download failed - output file not created"
              }
          } catch {
  Error:             $errorMessage = "[ERROR] Failed processing $key: $_"
              Write-Error $errorMessage
              $errorMessage | Out-File ".\logs\${key}_error.log" -Append
              $hasErrors = $true
              continue
          }
      }
      catch {
  Error:         $errorMessage = "[ERROR] Failed processing $key :`n$_"
          Write-Error $errorMessage
          $errorMessage | Out-File ".\logs\${key}_error.log" -Append
          $hasErrors = $true
          continue
      }
  }
  
  if ($hasErrors) {
      Write-Output "[INFO] Errors occurred during package processing. Check logs directory for details."
      Get-ChildItem -Path ".\logs" -Filter "*_error.log" | ForEach-Object {
          Write-Output "`nErrors for $($_.BaseName):"
          Get-Content $_.FullName | ForEach-Object { Write-Output "  $_" }
      }
      exit 1
  }
  shell: C:\Program Files\PowerShell\7\pwsh.EXE -command ". '{0}'"
  env:
    BASE_IMAGE: fajob
    BASE_TAG: latest
    QUAY: registry.cigna.com/cognizant
    PACKAGE_VERSION: 1.12
    PACKAGE_BUILD: 1
  
ParserError: C:\a\_temp\ddd7cab1-1304-4fd6-8302-36cf8615d645.ps1:123
Line |
Error:  123 |              $errorMessage = "[ERROR] Failed processing $key: $_"
     |                                                         ~~~~~
     | Variable reference is not valid. ':' was not followed by a valid variable name character. Consider using ${} to
     | delimit the name.
Error: Process completed with exit code 1.
============================================

Run Write-Output "[INFO] Fetching NuGet Packages..."
[INFO] Fetching NuGet Packages...
package version 1.12
[INFO] Processing gbs-fcts-lpi-calc (version: 5.0.3, build: 1)
[INFO] Checking: https://cigna.jfrog.io/artifactory/cigna-nuget-lower/Cigna/GBS/Cornerstone/Facets/gbs-fcts-lpi-calc/
Write-Error: [ERROR] Failed processing gbs-fcts-lpi-calc :
Error: [ERROR] Failed processing gbs-fcts-lpi-calc
Status Code: 403
Status Description: 
Error: 
403 Forbidden

403 Forbidden
nginx


Error: Process completed with exit code 1.
==============================================

Run Write-Output "[INFO] Fetching NuGet Packages..."
[INFO] Fetching NuGet Packages...
[INFO] Processing gbs-fcts-lpi-calc (version: 5.0.3, build: 1)
[INFO] Checking: https://cigna.jfrog.io/artifactory/cigna-nuget-lower/Cigna/GBS/Cornerstone/Facets/gbs-fcts-lpi-calc/
Write-Error: [ERROR] Failed processing gbs-fcts-lpi-calc :
Error: [ERROR] Repository access check failed for gbs-fcts-lpi-calc
Status Code: 403
Status Description: 
Access Forbidden - Please check:
1. Repository path is correct
2. Network access is available
3. Artifactory permissions are set correctly
Error: Process completed with exit code 1.

================================
Run Write-Output "[INFO] Fetching NuGet Packages..."
[INFO] Fetching NuGet Packages...
[INFO] Skipping PACKAGE version entry
[INFO] Processing gbs-fcts-lpi-calc (version: 5.0.3, build: 1)
[INFO] Checking: https://cigna.jfrog.io/artifactory/cigna-nuget-lower/Cigna/GBS/Cornerstone/Facets/gbs-fcts-lpi-calc/
WARNING: [WARN] Failed processing gbs-fcts-lpi-calc : 
403 Forbidden

403 Forbidden
nginx


=================================




Looking for manifests in: .\fajob
Found 1 manifest files
Processing manifest: manifest.json
  Added/Updated package: package-version (version: )
  Added/Updated package: usmg-fcts-lpi-calc (version: )
Writing 2 packages to manifest.json
Successfully created manifest.json

----------
manifest.json
{
    "package-version": {
        "build": "1",
        "version": "1.10",
        "name": "PACKAGE"
    },
    "gbs-fcts-lpi-calc": {
        "build": "1",
        "version": "5.0.1",
        "name": "LPI"
    }
}
-----------
===============================

shell: C:\Program Files\PowerShell\7\pwsh.EXE -command ". '{0}'"
  env:
    BASE_IMAGE: fajob
    BASE_TAG: latest
    QUAY: registry.cigna.com/cognizant
    ARTIFACTORY_TOKEN: ***
 Authenticating with Artifactory...
Write-Error: Failed to process packages: Failed to authenticate with Artifactory: Response status code does not indicate success: 403 (Forbidden).
Error: Process completed with exit code 1.

=================================

Authenticating with Artifactory...
 Processing package:  v.
Write-Error: Failed to process packages:  Failed processing  : Response status code does not indicate success: 401 (Unauthorized).
Error: Process completed with exit code 1.

=================


Run $requiredVars = @('BASE_IMAGE', 'BASE_TAG', 'QUAY')
  
ParserError: C:\a\_temp\643bd70c-913e-4d45-a7a8-3712f787f056.ps1:3
Line |
   3 |  $missingVars = $requiredVars.Where({ -not $env:$_ })
     |                                            ~~~~~
     | Variable reference is not valid. ':' was not followed by a valid variable name character. Consider using ${} to
     | delimit the name.
Error: Process completed with exit code 1.

==================


Run $packages = Get-Content './manifest.json' | ConvertFrom-Json
Fetching package  version  build ...
Invoke-WebRequest: C:\a\_temp\86277237-acd4-4708-9ab2-f7472e9bfe09.ps1:10
Line |
  10 |    $links = (Invoke-WebRequest $url).Links | Where-Object { $_.href -l …
     |              ~~~~~~~~~~~~~~~~~~~~~~
     |  403 Forbidden  403 Forbidden nginx   
Error: Process completed with exit code 1.
